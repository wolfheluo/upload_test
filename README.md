# 檔案上傳系統 - 安全指南

這是一個支援大檔案分塊上傳的伺服器系統，已實施多層防護措施以防止惡意檔案上傳和執行。

## 安全特性

1. **檔案類型限制**：僅允許上傳安全的檔案類型，如文檔、圖片、音訊、視訊和特定壓縮檔。

2. **檔案內容檢測**：使用多種技術檢測檔案是否包含惡意程式碼：
   - MIME 類型偵測（使用 python-magic）
   - 檔案簽名識別
   - 可執行檔特徵檢測
   - 壓縮檔內容分析
   - 惡意程式碼模式識別

3. **執行權限控制**：上傳的檔案不具有執行權限，防止直接執行

4. **輸入驗證**：對所有用戶輸入進行驗證，防止注入攻擊

5. **安全的檔案名處理**：使用 secure_filename 確保檔案名安全

## 部署前準備

1. 安裝相依套件：
   ```
   pip install -r requirements.txt
   ```

2. 在 Windows 環境下需要額外安裝：
   ```
   pip install python-magic-bin
   ```

3. Linux 環境下需要：
   ```
   sudo apt-get install libmagic1
   ```

## 最佳實踐建議

1. **使用 HTTPS**：在生產環境中啟用 HTTPS，防止資料傳輸被攔截

2. **定期更新掃描模式**：更新 `scan_file_for_malware` 函數中的惡意程式碼樣本庫

3. **整合第三方防毒 API**：可考慮整合像 ClamAV 或商業防毒 API

4. **監控日誌**：定期檢查 upload_server.log 中的警告和錯誤

5. **限制上傳目錄訪問**：設定 Web 伺服器確保上傳目錄不能執行程式碼
   - Apache: 在虛擬主機設定中添加 `php_flag engine off`
   - Nginx: 設定 `location` 區塊確保 PHP 等腳本不被處理

6. **設定檔案存儲目錄**：確保上傳目錄位於 Web 根目錄之外

7. **定期掃描已上傳檔案**：設定定時任務定期掃描上傳目錄中的檔案

8. **實施檔案大小限制**：控制上傳檔案的大小上限

## 如何加強安全性

若需更多安全保障，可考慮：

1. 整合雲端防毒服務如 VirusTotal API
2. 實施基於文件哈希的白名單系統
3. 在隔離環境中分析檔案行為
4. 增加 CAPTCHA 防止自動化攻擊
5. 實施按 IP 的上傳頻率限制
